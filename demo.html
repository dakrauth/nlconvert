<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Conversion Formula</title>
    <style type="text/css" media="screen">
        table { border-collapse: collapse; border: 1px solid #777; }
        td, th { border: 1px solid #777; padding: 0 1em; width: 10em; }
        thead th { background-color: #bbb; }
        tbody tr:nth-child(odd) { background-color: #ddd; }
        .input { padding: 6px; border-radius: 6px; border: 1px solid #ccc; display: inline-block; margin-right: 1em;}
        /*tr td:nth-child(3) { text-align: right; }*/
    </style>
</head>
<body>
    <p>
        Convert: <input id="converter" class="input" value="50"><span class="conversion"></span>
    </p>
    <div class="conversions"></div>
    <script src="nlconvert.js"></script>
    <script>
        var show_conversion_table = function(formulas) {
            var caret_re = /\^(\d)/;
            var markup = function(text) { return text.replace(caret_re, '<sup>$1</sup>'); };
            var html = '<table><thead><tr><th>From</th><th>To</th><th>Multiply by</th></tr></thead><tbody>$1</tbody></table>';
            var strip_zeros_re = /[.]0+$/;
            var rows;
            formulas.sort();
            rows = formulas.map(function(row) {
                var val = row[2];
                if(typeof val === 'number') {
                    val = (val < 0.0001) ? val.toFixed(6) : val.toFixed(val >= 1 ? 3 : 4);
                    val  = val.replace(strip_zeros_re, '');
                }
                else {
                    val = val.toString();
                    val = val.substring(val.indexOf('{') + 1, val.indexOf('}'));
                    val = val.replace('return ', '').replace(';', '');
                }
                return '<tr><td>' + markup(row[0]) + '</td><td>' + markup(row[1]) + '</td><td>' + val + '</td></tr>';
            }).join('\n');
            document.querySelector('.conversions').innerHTML = html.replace('$1', rows);
        }
        show_conversion_table(Converter.formulas);
    </script>
    <script>
        var el = document.getElementById('converter');
        el.addEventListener('input', Converter.input_handler, false);
        el.dispatchEvent(new Event('input'));
        el.focus();
    </script>
</body>
</html>
