<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Conversion Formula</title>
    <style type="text/css" media="screen">
        body { font-family: Verdana, Helvetica, Arial, sans-serif; font-size: 13px; }
        table { border-collapse: collapse; border: 1px solid #ccc; font-size: 0.8; }
        th { text-align: left; }
        td, th { padding: 0 1em; min-width: 10em; padding: 4px; min-height: 1.5em;}
        thead th { background-color: #ccc; }
        tbody tr:nth-child(odd) { background-color: #eee; }
        .input { padding: 6px; border-radius: 6px; border: 1px solid #ccc; display: inline-block; margin-right: 1em;}
        .conversion span {
            display: inline-block;
              background: #afd1f4;
              padding: 2px 6px;
              border: 1px solid #8ca8c4;
              border-radius: 12px;
              margin-left: 4px;
              box-shadow: 1px 1px 4px rgba(0,0,0,0.25);
          }
          a.help {
              display: inline-block;
              font-size: 15px;
              text-align: center;
              border: 1px solid #035fda;
              background: #035fda;
              color: #fff;
              border-radius: 10px;
              width: 20px;
              height: 20px;
          }
    </style>
</head>
<body>
    <p>
        <a class="help">?</a> Convert: <input id="converter" class="input" value="50f"><span class="conversion"></span>
    </p>
    <div class="conversions"></div>
    <div id="help" style="display: none"></div>
    <script src="nlconvert.js"></script>
    <script>
        (function(units) {
            var html = '<table><thead><tr><th>From</th><th>Shortcuts</th><th>To</th><th>Multiply by</th></tr></thead><tbody>';
            var seen = {};
            var value_repr = function(val) {
                if(typeof val === 'number') {
                    val = (val < 0.0001) ? val.toFixed(6) : val.toFixed(val >= 1 ? 3 : 4);
                    return val.replace(/[.]0+$/, '');
                }
                val = val.toString();
                val = val.substring(val.indexOf('{') + 1, val.indexOf('}'));
                return val.replace('return ', '').replace(';', '');
            };
            Object.getOwnPropertyNames(units).forEach(function(key) {
                var unit_a = units[key];
                if(!seen.hasOwnProperty(unit_a.id)) {
                    seen[unit_a.id] = true;
                    unit_a.conversions.forEach(function(conv) {
                        html += (
                               '<tr>'
                             + '<td>' + Convert.swap_caret(unit_a.single) + '</td>'
                             + '<td>' + unit_a.abbr + '</td>'
                             + '<td>' + Convert.swap_caret(conv.to_unit.single) + '</td>'
                             + '<td>' + value_repr(conv.value) + '</td>'
                             + '</tr>'
                        );
                    });
                }
            });
            document.getElementById('help').innerHTML = html + '</tbody></table>';
        }(Convert.UOM.units));

        var el = document.getElementById('converter');
        var handler = function(result) {
            console.table(result.values);
            if(result && result.values.length) {
                this.nextSibling.innerHTML += result.values.reduce(function(prev, curr) {
                    return prev + '<span>' + Convert.swap_caret(curr) + '</span>';
                }, '');
            }
            else {
                this.nextSibling.innerHTML = 'Unknown conversion';
            }
        };
        var help = document.querySelector('a.help');
        help.addEventListener('click', function() {
            var el = document.getElementById('help');
            el.style.display = (el.style.display === 'none') ? 'block' : 'none';
        }, false);
        
        Convert.register_input_handler(el, handler);
        el.dispatchEvent(new Event('input'));
        el.focus();
    </script>
</body>
</html>
